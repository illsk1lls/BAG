@ECHO OFF & CD /D "%~dp0" && (IF EXIST "%temp%\getadmin.vbs" DEL "%temp%\getadmin.vbs") && fsutil dirty query %systemdrive% 1>NUL 2>NUL || (ECHO Set UAC = CreateObject^("Shell.Application"^) : UAC.ShellExecute "cmd.exe", "/k CD ""%~sdp0"" && %~s0 %1", "", "runas", 1 >> "%temp%\getadmin.vbs" && "%temp%\getadmin.vbs" && EXIT /B) & IF NOT [%1]==[] ((IF "%~n0"=="fullBAG" EXIT) & ECHO FILLING BAG... & CERTUTIL -ENCODE -F """%1""" """%TEMP%\%~n1.000""">nul & powershell -nop -c ^(Get-Content """%TEMP%\%~n1.000"""^) -replace '^^^','::' -replace '-----BEGIN CERTIFICATE-----','%~n1%~x1::' -replace '-----END CERTIFICATE-----','%~n1%~x1::' ^| Set-Content """%TEMP%\%~n1.001""" & DEL "%TEMP%\%~n1.000" /F /Q>nul & powershell -nop -c Add-Content -Path """%~f0""" -Value ^(Get-Content -Path """%TEMP%\%~n1.001"""^) & DEL "%TEMP%\%~n1.001" /F /Q>nul & DEL "%1" /F /Q>nul & COPY /Y "%~f0" "%~dp0fullBAG.cmd" & GOTO 2>nul & del "%~f0" & EXIT) ELSE ((IF "%~n0"=="emptyBAG" EXIT) & ECHO EMPTYING BAG... & powershell -nop -c $file=Get-Content '%~f0'; $r=[regex]::Match^($file,'\:\:^([^^^\:]+^)\:\:^(.+?^)\:\:\1\:\:'^).Groups[2].Value.Replace^(' ',"""`n"""^).Replace^('::',''^) ^| Set-Content '%TEMP%\%~n1.003' & powershell -nop -c ^(Get-Content """%~f0""" ^| Select-Object -Skip 1^) ^| Set-Content """%TEMP%\%~n1.002""" & set /p FNAME=<"%TEMP%\%~n1.002" & DEL "%TEMP%\%~n1.002" /F /Q>nul & SETLOCAL ENABLEDELAYEDEXPANSION & CERTUTIL -DECODE -F "%TEMP%\%~n1.003" "!FNAME::=!">nul & ENDLOCAL & DEL "%TEMP%\%~n1.003" /F /Q>nul & powershell -nop -c ^(get-content """%~f0""" -totalcount 1^) ^| set-content """%~dp0emptyBAG.cmd""" & GOTO 2>nul & del "%~f0" & EXIT)
REM
